<div class="container py-4">
    <div class="card shadow-sm mx-auto" style="max-width: 1200px;">
        <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
            <h5 class="mb-0">Inspection Details</h5>
        </div>

        <div class="card-body p-4">
            <div *ngIf="errorMessage" class="alert alert-danger">
                {{ errorMessage }}
            </div>
            <div class="table-responsive">
                <table class="table table-hover table-striped align-middle">
                    <thead class="table-light">
                        <tr>
                            <th>Inspection Date</th>
                            <th>Unit Number</th>
                            <th>Inspection Mode</th>
                            <th>Def. Category</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                <tbody>
  <tr *ngIf="!inspdata || inspdata.length === 0">
    <td colspan="6" class="text-center py-3">No inspection details available</td>
  </tr>
  <tr *ngFor="let item of inspdata">
    <td>{{ item.inspection_date | date:'dd-MM-yyyy' }}</td>
    <td>{{ item.unit_number }}</td>
    <td>{{ item.inspection_mode }}</td>
    <td>{{ item.deficiency_category }}</td>
<td>
    <span class="badge" [ngClass]="{
    'bg-success': item.status_update == '1'
  }">
        {{
        item.status_update == '1' ? 'For Approval' : 'Unknown Status' }}
    </span>
</td>
    <td>
      <button class="btn btn-sm btn-primary" (click)="ViewIdcarddetails(idcardModal, item)">
        <i class="bi bi-eye"></i> View
      </button>
    </td>
  </tr>
</tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- Modal for ID Card Details -->
<ng-template #idcardModal let-modal>
    <div class="modal-content">
        <div class="modal-header">
            <h5 class="modal-title" id="idcardModalLabel">Inspection Details</h5>
            <button type="button" class="btn-close" (click)="closeModal()" aria-label="Close"></button>
        </div>
        <div class="modal-body" *ngIf="inspdatabyid">
            <div *ngIf="successMessage" class="alert alert-success mb-3">
                {{ successMessage }}
            </div>
            <div *ngIf="errorMessage" class="alert alert-danger">
                {{ errorMessage }}
            </div>
            <div class="row">
                <div class="col-md-6 mb-3" *ngIf="inspdatabyid.official_name != null">
                    <strong>Official Name:</strong> {{ inspdatabyid.official_name }}
                </div>
                <div class="col-md-6 mb-3" *ngIf="inspdatabyid.official_designation != null">
                    <strong>Official Designation:</strong> {{ inspdatabyid.official_designation }}
                </div>
                <div class="col-md-6 mb-3" *ngIf="inspdatabyid.licensee_name != null">
                    <strong>Licensee Name:</strong> {{ inspdatabyid.licensee_name }}
                </div>
                <div class="col-md-6 mb-3" *ngIf="inspdatabyid.licensee_number != null">
                    <strong>Licensee Number:</strong> {{ inspdatabyid.licensee_number }}
                </div>
                <div class="col-md-6 mb-3" *ngIf="inspdatabyid.licensee_division != null">
                    <strong>Licensee Division:</strong> {{ inspdatabyid.licensee_division }}
                </div>
                <div class="col-md-6 mb-3" *ngIf="inspdatabyid.inspection_date != null">
                    <strong>Inspection Date:</strong> {{ inspdatabyid.inspection_date | date:'dd-MM-yyyy' }}
                </div>
                <div class="col-md-6 mb-3" *ngIf="inspdatabyid.inspection_mode != null">
                    <strong>Inspection Mode:</strong> {{ inspdatabyid.inspection_mode }}
                </div>
                <div class="col-md-6 mb-3" *ngIf="inspdatabyid.train_number != null">
                    <strong>Train Number:</strong> {{ inspdatabyid.train_number }}
                </div>
                <div class="col-md-6 mb-3" *ngIf="inspdatabyid.unit_number != null">
                    <strong>Unit Number:</strong> {{ inspdatabyid.unit_number }}
                </div>
                <div class="col-md-6 mb-3" *ngIf="inspdatabyid.deficiency_category != null">
                    <strong>Deficiency Category:</strong> {{ inspdatabyid.deficiency_category }}
                </div>
                <div class="col-md-6 mb-3" *ngIf="inspdatabyid.deficiency_details != null">
                    <strong>Deficiency Details:</strong> {{ inspdatabyid.deficiency_details }}
                </div>
                <div class="col-md-6 mb-3" *ngIf="inspdatabyid.fine_imposed != null">
                    <strong>Fine Imposed:</strong> {{ inspdatabyid.fine_imposed || 'N/A' }}
                </div>
                <div class="col-md-6 mb-3" *ngIf="inspdatabyid.action_taken != null">
                    <strong>Action Taken:</strong> {{ inspdatabyid.action_taken || 'N/A' }}
                </div>
                <div class="col-md-6 mb-3" *ngIf="inspdatabyid.section != null">
                    <strong>Section:</strong> {{ inspdatabyid.section || 'N/A' }}
                </div>
                <div class="col-md-6 mb-3" *ngIf="inspdatabyid.station != null">
                    <strong>Station:</strong> {{ inspdatabyid.station || 'N/A' }}
                </div>
                <div class="col-md-6 mb-3" *ngIf="inspdatabyid.vendor_name != null">
                    <strong>Vendor Name:</strong> {{ inspdatabyid.vendor_name || 'N/A' }}
                </div>
                <div class="col-md-6 mb-3" *ngIf="inspdatabyid.vendor_aadhar != null">
                    <strong>Vendor Aadhar:</strong> {{ inspdatabyid.vendor_aadhar || 'N/A' }}
                </div>
                <div class="col-md-6 mb-3" *ngIf="inspdatabyid.action_remarks != null">
                    <strong>Action Taken Remarks:</strong> {{ inspdatabyid.action_remarks || 'N/A' }}
                </div>
                <form [formGroup]="inspectionForm">
                    <div class="row">
                        <div class="form-group col-md-6 mb-3">
                            <label>Action Taken<span class="required-asterisk">*</span></label>
                            <ng-select [items]="actionsTaken" bindLabel="label" bindValue="value"
                                formControlName="actionTaken" [searchable]="true"
                                placeholder="Select action"></ng-select>
                            <div class="invalid-feedback"
                                *ngIf="inspectionForm.get('actionTaken')?.invalid && (inspectionForm.get('actionTaken')?.dirty || inspectionForm.get('actionTaken')?.touched)">
                                Action Taken is required
                            </div>
                        </div>
                        <div class="form-group col-md-6 mb-3">
                            <label>Fine Imposed (Rs.)<span *ngIf="inspectionForm.get('actionTaken')?.value === 'Fined'"
                                    class="required-asterisk">*</span></label>
                            <input type="number" class="form-control" formControlName="fineImposed"
                                [ngClass]="{'is-invalid': inspectionForm.get('fineImposed')?.invalid && (inspectionForm.get('fineImposed')?.dirty || inspectionForm.get('fineImposed')?.touched)}" />
                            <div class="invalid-feedback"
                                *ngIf="inspectionForm.get('fineImposed')?.invalid && (inspectionForm.get('fineImposed')?.dirty || inspectionForm.get('fineImposed')?.touched)">
                                Fine Imposed is required when action is 'Fined' and must be non-negative
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Action Taken/Return Remarks<span class="required-asterisk">*</span></label>
                        <textarea class="form-control" formControlName="actionRemarks"
                            [ngClass]="{'is-invalid': inspectionForm.get('actionRemarks')?.invalid && (inspectionForm.get('actionRemarks')?.dirty || inspectionForm.get('actionRemarks')?.touched)}"></textarea>
                        <div class="invalid-feedback"
                            *ngIf="inspectionForm.get('actionRemarks')?.invalid && (inspectionForm.get('actionRemarks')?.dirty || inspectionForm.get('actionRemarks')?.touched)">
                            Action Taken Remarks is required
                        </div>
                    </div>
                </form>
                <br>
                <div class="modal-footer">
                    <button type="button" *ngIf="ccimenuselect === true && selectedIdcard" class="btn btn-success"
                        (click)="forward()" [disabled]="isLoading || inspectionForm.invalid">
                        <i class="bi bi-send"></i> {{ isLoading ? 'Processing...' : 'Submit' }}
                    </button>
                    <button type="button" *ngIf="ccimenuselect === true && selectedIdcard" class="btn btn-danger"
                        (click)="return()" [disabled]="isLoading || !inspectionForm.get('actionRemarks')?.value">
                        <i class="bi bi-send"></i> {{ isLoading ? 'Processing...' : 'Return' }}
                    </button>
                    <button type="button" class="btn btn-secondary" (click)="closeModal()">Close</button>
                </div>
            </div>
        </div>
    </div>

</ng-template>